---
id: stack-env
title: Docker Stack Environment Setup
sidebar_position: 1
---

Use this guide whenever you need to bring up the full Docker stack (Postgres, Redis, backend, sandbox server, tool server, frontend, and ngrok). The stack reads its configuration from `docker/.stack.env`, so getting those variables right is the most important preparation step.

## Before You Start

- Install Docker Compose v2 and ensure it can start Linux containers.
- Install Node.js 18+ and Python 3.10+ (needed only when you want to run services outside of Docker).
- Obtain API keys or credentials for at least one LLM provider (OpenAI-compatible, Anthropic, Gemini, etc.).
- Download a Google Cloud service account JSON if you plan to store assets on GCS or call Vertex AI.

## Quick Start

1. Copy the sample file:
   ```bash
   cp docker/.stack.env.example docker/.stack.env
   ```
2. Update every variable marked as `replace-me` or `replace-with-your-token`. Use the reference below plus the optional pages for feature-specific keys.
3. Launch the stack:
   ```bash
   ./scripts/run_stack.sh --build
   ```
   The helper script ensures the env file exists, runs `docker compose -f docker/docker-compose.stack.yaml --env-file docker/.stack.env up`, and will re-use the same configuration for subsequent runs (omit `--build` after the first boot). Stop the stack with `docker compose -f docker/docker-compose.stack.yaml down`.

## Required Variables

| Section | Variable(s) | Purpose / Notes |
| --- | --- | --- |
| Frontend build | `FRONTEND_BUILD_MODE` | Usually `production`; switch to `development` only when debugging the Dockerized frontend build. |
|  | `VITE_API_URL` | URL the Vite frontend uses to call the backend (defaults to `http://localhost:8000`). |
|  | `VITE_GOOGLE_CLIENT_ID` | OAuth client ID used inside the browser; leave empty if you do not expose Google sign-in. |
|  | `VITE_STRIPE_PUBLISHABLE_KEY` | Client-side Stripe key if billing is enabled. |
|  | `VITE_SENTRY_DSN` | Optional Sentry DSN for browser error reporting. |
|  | `VITE_DISABLE_CHAT_MODE` | Set to `true` to hide the chat UI for demo-only builds. |
| Networking / tunnels | `NGROK_AUTHTOKEN` | Required token so the bundled ngrok process can create HTTPS tunnels. |
|  | `NGROK_REGION` | Closest ngrok region (`us`, `eu`, `ap`, etc.) to reduce latency. |
|  | `NGROK_AGENT_EXTRA_ARGS` | Additional CLI flags (reserved domain, headers, etc.); leave blank if unsure. |
| Host paths | `GOOGLE_APPLICATION_CREDENTIALS` | Absolute path on your machine to the Google Cloud service-account JSON that is mounted into containers. |
| LLM + auth | `LLM_CONFIGS` | JSON blob that lists every backend-accessible LLM (model id, API key, base URL, retries, etc.). At least one entry must be valid. |
|  | `RESEARCHER_AGENT_CONFIG` | JSON that defines which models power the researcher/report agents that run multi-step plans. |
|  | `GOOGLE_CLIENT_ID` | Backend OAuth client ID used when users authenticate via Google. |
|  | `GOOGLE_REDIRECT_URI` | Callback URL for OAuth (keep the provided localhost callback for local runs). |
|  | `ACCESS_TOKEN_EXPIRE_MINUTES` | Lifetime for JWT access tokens issued by the backend. |
|  | `ENHANCE_PROMPT_OPENAI_API_KEY` | Optional OpenAI-compatible key used by the prompt enhancer pipeline. |
| Storage | `SLIDE_ASSETS_PROJECT_ID` / `SLIDE_ASSETS_BUCKET_NAME` | GCP project and bucket where rendered slide decks are written. |
|  | `FILE_UPLOAD_PROJECT_ID` / `FILE_UPLOAD_BUCKET_NAME` | Destination for general file uploads. |
|  | `AVATAR_PROJECT_ID` / `AVATAR_BUCKET_NAME` | Bucket dedicated to avatar uploads. |
|  | `CUSTOM_DOMAIN` | Public domain used when building shareable URLs (`sfile.ii.inc` by default). |
| Backend sandbox | `SANDBOX_TEMPLATE_ID` | Template ID used when provisioning sandbox containers. |
|  | `TIME_TIL_CLEAN_UP` | Idle timeout (seconds) before sandboxes are terminated. |
| Tool server (baseline) | `STORAGE_CONFIG__GCS_BUCKET_NAME` / `STORAGE_CONFIG__GCS_PROJECT_ID` | Default bucket/project for artifacts generated by the tool server. |
| Sandbox server | `E2B_API_KEY` | API key for the e2b sandbox platform. |
|  | `E2B_TEMPLATE_ID` | e2b template ID used for launching sandboxes. |
| Core infrastructure | `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB`, `POSTGRES_PORT` | Local Postgres credentials and the host port exposed by Docker. |
|  | `SANDBOX_DB_NAME`, `SANDBOX_DATABASE_URL` | Async connection info for the sandbox service (keep the default unless you have a custom database). |
|  | `DATABASE_URL` | Async connection string used by the backend app. |
|  | `REDIS_PORT` | Host port for Redis. |
|  | `BACKEND_PORT`, `FRONTEND_PORT`, `SANDBOX_SERVER_PORT`, `TOOL_SERVER_PORT`, `NGROK_METRICS_PORT`, `MCP_PORT` | Host ports used by each HTTP-facing service plus the ngrok dashboard and MCP server. Adjust only if the defaults conflict with something else on your machine. |

## Required Variable Guides

Each section above links to a dedicated page containing acquisition steps, UI paths, and sanity checks for the associated variables:

- [Frontend environment variables](/docs/required-environment-variables/frontend-env)
- [Networking / tunnels](/docs/required-environment-variables/networking-tunnels)
- [Host paths](/docs/required-environment-variables/host-paths)
- [LLM and authentication](/docs/required-environment-variables/llm-auth)
- [Storage buckets and domains](/docs/required-environment-variables/storage)
- [Backend sandbox configuration](/docs/required-environment-variables/backend-sandbox)
- [Tool server baseline storage](/docs/required-environment-variables/tool-server-baseline)
- [Sandbox server integration](/docs/required-environment-variables/sandbox-server)
- [Core infrastructure (databases, ports, queues)](/docs/required-environment-variables/core-infra)

## Optional Feature Sets

Some integrations are optional and can be configured later. Each set has its own guide with detailed setup steps:

- [Payment configuration](/docs/optional-environment-variables/payment)
- [Media generation (image/video)](/docs/optional-environment-variables/media-generation)
- [Web search providers](/docs/optional-environment-variables/web-search)
- [Web visit / browsing providers](/docs/optional-environment-variables/web-visits)
- [Image-specific search](/docs/optional-environment-variables/image-search)
- [Neon database automation](/docs/optional-environment-variables/database-neon)
- [Tool-server LLM override](/docs/optional-environment-variables/tool-server-llm)

Refer back to this page whenever you add new variables so you can quickly sanity-check the base sections.
